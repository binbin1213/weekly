# 📝 更新日志

## 2025-11-05 - 优化同步策略

### 🎯 优化内容

**将同步频率从每6小时调整为每周五一次**

#### 问题分析
- ❌ 之前：每6小时同步一次（每天4次，每周28次）
- ❌ 实际：阮老师每周五才发布新文章
- ❌ 结果：超过98%的同步都是无效的

#### 优化方案
- ✅ 现在：每周五北京时间18:00同步一次
- ✅ 匹配：正好是周刊发布时间
- ✅ 效率：减少96%的无效同步（28次→1次/周）
- ✅ 灵活：保留手动触发功能

#### 修改文件
```yaml
# .github/workflows/sync-upstream.yml
schedule:
  - cron: '0 10 * * 5'  # UTC 10:00 = 北京时间 18:00（周五）
```

#### 效果对比
| 指标 | 之前 | 现在 | 优化 |
|------|-----|------|------|
| 每周同步 | 28次 | 1次 | -96% |
| 每年同步 | ~1,460次 | ~52次 | -96% |
| 有效率 | ~4% | ~100% | +2400% |

详细说明请查看：`同步策略说明.md`

---

## 2025-11-05 - 实现最新期号自动更新

### 🎯 解决的问题

之前项目中存在多处硬编码的 `issue-368` 链接：
- ❌ `index.md` - 首页"阅读最新一期"按钮
- ❌ `index.md` - "最新期刊"部分链接
- ❌ `.vitepress/config.ts` - 导航栏"最新期刊"
- ❌ `.vitepress/config.ts` - 导航栏"2025"年份

每次同步新文章后，需要手动更新这些链接，容易遗漏。

### ✅ 实现的功能

#### 1. 新增文件

| 文件 | 功能 |
|------|------|
| `scripts/get-latest-issue.ts` | 自动扫描并获取最新期号和标题 |
| `scripts/update-index.ts` | 自动更新 `index.md` 中的硬编码链接 |
| `.vitepress/theme/utils.ts` | 提供主题工具函数 |
| `自动更新说明.md` | 详细的使用说明文档 |

#### 2. 修改文件

| 文件 | 修改内容 |
|------|----------|
| `.vitepress/config.ts` | 导入并使用 `getLatestIssueNumber()` 动态获取最新期号 |
| `package.json` | 添加 `update-index` 和 `get-latest` 命令 |
| `vercel.json` | 更新构建命令，在构建前执行 `update-index` |

### 🚀 工作流程

```
新文章同步 (issue-369.md)
    ↓
自动部署触发
    ↓
npm run build
    ├─ npm run update-index  (更新 index.md)
    ├─ vitepress build       (动态读取最新期号)
    └─ npm run generate-rss  (生成 RSS)
    ↓
部署完成 ✅
```

### 📊 使用方法

#### 自动更新（推荐）
```bash
# 构建时自动更新
npm run build
```

#### 手动更新
```bash
# 更新 index.md 中的链接
npm run update-index

# 查看当前最新期号
npm run get-latest
```

### 🎯 效果

- ✅ **完全自动化** - 无需手动编辑任何文件
- ✅ **零维护成本** - 设置一次，永久生效
- ✅ **智能检测** - 自动识别最新期号和标题
- ✅ **多平台支持** - GitHub Pages / Vercel / Cloudflare Pages

### 🧪 测试结果

```bash
$ npm run get-latest
✅ 找到最新一期：issue-368
期号: 368
标题: 不要这样管理软件团队
链接: /docs/issue-368

$ npm run update-index
✅ 已更新首页按钮链接
✅ 已更新"最新期刊"部分
✅ index.md 更新成功！
```

### 📚 相关文档

详细说明请查看：`自动更新说明.md`

---

## 下次更新计划

- [ ] 添加自动生成年份归档链接
- [ ] 优化构建性能
- [ ] 添加更多的自动化测试

