# 🔄 同步策略优化说明

## 📊 问题分析

### 之前的策略
```yaml
schedule:
  - cron: '0 */6 * * *'  # 每6小时一次
```

- ⏰ **频率**：每天 4 次，每周 28 次
- 📈 **年同步次数**：约 1,460 次
- ❌ **实际需要**：每周只有 1 篇新文章
- 💸 **浪费率**：超过 98% 的同步都是无效的

### 实际情况
- 📅 阮老师**每周五下午**发布周刊
- 📊 每月 4-5 期，每周 1 期
- ⚠️ 非周五时间同步都是浪费资源

---

## ✅ 优化方案

### 🎯 方案一：精准同步（已采用）

**每周五北京时间 18:00 同步一次**

```yaml
schedule:
  - cron: '0 10 * * 5'  # UTC 10:00 = 北京时间 18:00
```

**优点：**
- ✅ 最精准：正好是发布时间
- ✅ 最省资源：每周只同步 1 次
- ✅ 年同步次数：约 52 次（减少 96%）
- ✅ 符合实际需求

**缺点：**
- ⚠️ 如果某周五未发布，需要等下周
- ⚠️ 解决方案：保留手动触发功能

---

### 🔄 方案二：保守同步（备选）

**每天同步一次，周五多次**

```yaml
schedule:
  # 每周五检查3次（上午、下午、晚上）
  - cron: '0 2,10,14 * * 5'   # 周五 10:00, 18:00, 22:00 (北京时间)
  # 其他日子凌晨检查一次
  - cron: '0 18 * * 0-4,6'    # 其他日子凌晨2点
```

**优点：**
- ✅ 周五及时性更好
- ✅ 其他日子也能检测到补发的文章

**缺点：**
- ⚠️ 年同步次数：约 470 次
- ⚠️ 仍有较多无效同步

---

### ⚡ 方案三：高频同步（不推荐）

**每天同步一次**

```yaml
schedule:
  - cron: '0 10 * * *'  # 每天北京时间18:00
```

**优点：**
- ✅ 及时性好

**缺点：**
- ❌ 年同步次数：365 次
- ❌ 仍有大量无效同步

---

## 🎯 推荐配置

### 当前采用的最优方案

```yaml
on:
  # 每周五北京时间18:00同步（最佳时间）
  schedule:
    - cron: '0 10 * * 5'
  
  # 允许手动触发（紧急情况使用）
  workflow_dispatch:
```

### 为什么选择这个方案？

1. **精准匹配发布时间**
   - 阮老师每周五发布
   - 我们每周五同步
   - 完美契合！

2. **最大化资源利用**
   - 从每周 28 次 → 1 次
   - 减少 **96%** 的无效同步
   - GitHub Actions 免费额度节省

3. **保留灵活性**
   - 手动触发功能随时可用
   - 特殊情况立即同步
   - 不影响使用体验

---

## 🔧 如何切换同步策略？

### 切换到方案二（每天同步）

编辑 `.github/workflows/sync-upstream.yml`：

```yaml
on:
  schedule:
    - cron: '0 10 * * *'  # 每天北京时间18:00
  workflow_dispatch:
```

### 切换回高频同步（6小时）

```yaml
on:
  schedule:
    - cron: '0 */6 * * *'  # 每6小时一次
  workflow_dispatch:
```

---

## 📅 Cron 时间说明

### GitHub Actions 使用 UTC 时间

| UTC 时间 | 北京时间 | 说明 |
|---------|---------|------|
| `0 10 * * 5` | 周五 18:00 | **推荐**：正好是发布时间 |
| `0 2 * * 5` | 周五 10:00 | 早上同步 |
| `0 14 * * 5` | 周五 22:00 | 晚上同步 |
| `0 18 * * *` | 每天 02:00 | 凌晨同步 |

### Cron 语法快速参考

```
┌───────────── 分钟 (0-59)
│ ┌─────────── 小时 (0-23)
│ │ ┌───────── 日期 (1-31)
│ │ │ ┌─────── 月份 (1-12)
│ │ │ │ ┌───── 星期 (0-6, 0=周日)
│ │ │ │ │
│ │ │ │ │
* * * * *

示例：
'0 10 * * 5'    - 每周五 10:00
'0 */6 * * *'   - 每6小时
'0 2 * * *'     - 每天凌晨2点
'0 10 * * 1-5'  - 周一到周五 10:00
```

---

## 🔍 手动触发同步

不想等到周五？随时可以手动触发：

### 方法一：GitHub 网页

1. 进入 GitHub 仓库
2. 点击 **Actions** 标签
3. 选择 **同步上游仓库**
4. 点击 **Run workflow**
5. 点击绿色 **Run workflow** 按钮

### 方法二：本地命令

```bash
# 添加上游仓库（首次执行）
git remote add upstream https://github.com/ruanyf/weekly.git

# 拉取并合并
git pull upstream master

# 推送到你的仓库
git push origin master
```

---

## 📊 效果对比

### 资源使用对比

| 方案 | 每周次数 | 每年次数 | 有效率 | 推荐度 |
|------|---------|---------|--------|--------|
| 每6小时 | 28 次 | ~1,460 次 | ~4% | ⭐ |
| 每天一次 | 7 次 | ~365 次 | ~14% | ⭐⭐⭐ |
| **每周五** | **1 次** | **~52 次** | **~100%** | ⭐⭐⭐⭐⭐ |

### 及时性对比

| 方案 | 最快发现 | 最慢发现 | 平均延迟 |
|------|---------|---------|----------|
| 每6小时 | 立即 | 6小时 | 3小时 |
| 每天一次 | 立即 | 24小时 | 12小时 |
| **每周五** | **立即** | **7天** | **<1小时*** |

*假设在周五发布时间同步

---

## 💡 最佳实践建议

### 1. 使用周五同步（推荐）
- ✅ 最符合实际需求
- ✅ 最节省资源
- ✅ 几乎 100% 有效同步

### 2. 保留手动触发
- ✅ 应对特殊情况
- ✅ 测试时使用
- ✅ 紧急更新使用

### 3. 监控同步状态
- 定期检查 Actions 运行日志
- 确认同步成功
- 发现问题及时处理

### 4. 备用方案
如果某周五未发布：
- 下周五自动检查
- 或手动触发同步
- 不影响正常使用

---

## 🎉 总结

**当前配置：每周五北京时间 18:00 同步**

- ✅ 精准：正好是发布时间
- ✅ 高效：减少 96% 无效同步
- ✅ 灵活：支持手动触发
- ✅ 可靠：不会错过更新

这是针对阮老师周刊的**最优同步策略**！🚀

