# 🔍 搜索功能说明

## ⚠️ 当前状态

由于本项目包含 **379 篇周刊文章**，VitePress 的本地搜索索引非常大（约 50-100MB），会导致：
- 🐌 搜索框打开缓慢或卡死
- 💾 占用大量内存
- ⏱️ 首次加载时间长

**因此我们已暂时禁用了内置搜索功能。**

---

## 🎯 临时解决方案（推荐）

### 方案 1：使用浏览器内置搜索

**最简单！** 使用浏览器的页面内搜索：

- **Windows/Linux**: `Ctrl + F`
- **macOS**: `Cmd + F`

**使用方法**：
1. 打开侧边栏，展开你想搜索的年份
2. 使用 `Ctrl+F` / `Cmd+F` 搜索标题
3. 找到文章后点击打开

**优点**：
- ✅ 即时响应，不卡顿
- ✅ 可以搜索页面上的任何内容
- ✅ 无需额外配置

---

### 方案 2：使用 GitHub 搜索

在 GitHub 仓库中搜索：

```
https://github.com/binbin1213/weekly
```

1. 点击仓库页面顶部的搜索框
2. 输入关键词
3. 在 `docs/` 目录中查找

**优点**：
- ✅ 可以搜索全部文章内容
- ✅ 支持高级搜索语法
- ✅ 显示搜索结果上下文

---

## 🚀 长期解决方案

### 选项 A：Algolia DocSearch（推荐）

**Algolia DocSearch** 是专为文档网站设计的免费搜索服务。

#### 优点
- ⚡ 极快的搜索速度
- 🎯 相关性高
- 🆓 对开源项目完全免费
- 🌍 全球 CDN

#### 申请步骤

1. **访问 Algolia DocSearch**
   ```
   https://docsearch.algolia.com/apply/
   ```

2. **填写申请表**
   - Website URL: `https://binbin1213.github.io/weekly/`
   - Email: 你的邮箱
   - Repository: `https://github.com/binbin1213/weekly`
   
   **要求**：
   - ✅ 网站必须公开访问
   - ✅ 是技术文档/博客
   - ✅ 你是网站所有者

3. **等待批准**
   - 通常 1-2 周内回复
   - 批准后会收到配置信息

4. **集成到网站**

   收到 Algolia 的配置信息后，编辑 `.vitepress/config.ts`：

   ```typescript
   export default defineConfig({
     // ...
     
     themeConfig: {
       // 删除或注释掉现有的 search 配置
       
       // 添加 Algolia 搜索
       search: {
         provider: 'algolia',
         options: {
           appId: 'YOUR_APP_ID',           // Algolia 提供
           apiKey: 'YOUR_API_KEY',         // Algolia 提供
           indexName: 'YOUR_INDEX_NAME',   // Algolia 提供
           placeholder: '搜索文档',
           translations: {
             button: {
               buttonText: '搜索',
               buttonAriaLabel: '搜索'
             },
             modal: {
               searchBox: {
                 resetButtonTitle: '清除查询条件',
                 resetButtonAriaLabel: '清除查询条件',
                 cancelButtonText: '取消',
                 cancelButtonAriaLabel: '取消'
               },
               startScreen: {
                 recentSearchesTitle: '搜索历史',
                 noRecentSearchesText: '没有搜索历史',
                 saveRecentSearchButtonTitle: '保存至搜索历史',
                 removeRecentSearchButtonTitle: '从搜索历史中移除',
                 favoriteSearchesTitle: '收藏',
                 removeFavoriteSearchButtonTitle: '从收藏中移除'
               },
               errorScreen: {
                 titleText: '无法获取结果',
                 helpText: '你可能需要检查你的网络连接'
               },
               footer: {
                 selectText: '选择',
                 navigateText: '切换',
                 closeText: '关闭',
                 searchByText: '搜索提供者'
               },
               noResultsScreen: {
                 noResultsText: '无法找到相关结果',
                 suggestedQueryText: '你可以尝试查询',
                 reportMissingResultsText: '你认为该查询应该有结果？',
                 reportMissingResultsLinkText: '点击反馈'
               }
             }
           }
         }
       }
     }
   })
   ```

5. **测试搜索**
   - 重新构建网站
   - 测试搜索功能

---

### 选项 B：自建搜索服务

如果不想等待 Algolia 审核，可以自建搜索：

#### 1. 使用 Pagefind（推荐）

**Pagefind** 是一个静态搜索库，零配置。

```bash
# 安装
npm install -D pagefind

# 在 package.json 添加脚本
{
  "scripts": {
    "build": "vitepress build && pagefind --source .vitepress/dist"
  }
}
```

#### 2. 使用 FlexSearch

轻量级的全文搜索库。

```bash
npm install flexsearch
```

#### 3. 使用 Meilisearch

开源的搜索引擎，可以自己部署。

```bash
# Docker 部署
docker run -d -p 7700:7700 getmeili/meilisearch
```

---

### 选项 C：优化 VitePress 本地搜索

如果一定要使用本地搜索，可以尝试以下优化：

#### 1. 排除部分文章

编辑 `.vitepress/config.ts`：

```typescript
export default defineConfig({
  // ...
  
  themeConfig: {
    search: {
      provider: 'local',
      options: {
        // 排除一些文件
        exclude: (relativePath) => {
          // 只索引最近50期
          const match = relativePath.match(/issue-(\d+)\.md/)
          if (match) {
            const num = parseInt(match[1])
            return num < 319 // 排除第319期之前的文章
          }
          return false
        },
        
        // 性能优化
        miniSearch: {
          options: {
            // 减少索引字段
            fields: ['title', 'titles'],
            storeFields: ['title', 'titles']
          },
          searchOptions: {
            fuzzy: 0.1,
            prefix: true
          }
        }
      }
    }
  }
})
```

#### 2. 限制索引内容长度

创建插件 `.vitepress/plugins/search-limit.ts`：

```typescript
export function searchLimitPlugin() {
  return {
    name: 'search-limit',
    transform(code, id) {
      if (id.endsWith('.md')) {
        // 只索引前1000个字符
        return code.slice(0, 1000)
      }
    }
  }
}
```

---

## 📊 方案对比

| 方案 | 性能 | 体验 | 成本 | 难度 |
|-----|------|------|------|------|
| **浏览器搜索** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | 免费 | ⭐ |
| **GitHub 搜索** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 免费 | ⭐ |
| **Algolia DocSearch** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 免费 | ⭐⭐⭐ |
| **Pagefind** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 免费 | ⭐⭐ |
| **优化本地搜索** | ⭐⭐⭐ | ⭐⭐⭐ | 免费 | ⭐⭐⭐⭐ |
| **自建 Meilisearch** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 需服务器 | ⭐⭐⭐⭐⭐ |

---

## 🎯 我的建议

### 短期（现在）
使用**浏览器内置搜索**（`Ctrl+F` / `Cmd+F`）

### 中期（1-2周）
申请 **Algolia DocSearch**（最佳方案）

### 长期（可选）
如果 Algolia 没批准，使用 **Pagefind**

---

## 💡 用户使用提示

可以在首页添加搜索提示：

编辑 `index.md`：

```markdown
## 📖 如何查找文章

由于文章数量较多，建议使用以下方式查找：

1. **浏览器搜索**：按 `Ctrl+F` (Windows) 或 `Cmd+F` (Mac) 搜索页面
2. **按年份浏览**：使用左侧侧边栏按年份查看
3. **GitHub 搜索**：在 [GitHub 仓库](https://github.com/binbin1213/weekly) 中搜索
4. **RSS 订阅**：通过 RSS 阅读器关注最新文章
```

---

## 🔧 重新启用搜索

如果将来想重新启用搜索，编辑 `.vitepress/config.ts`，取消注释搜索配置。

---

## 📝 相关资源

- [Algolia DocSearch 申请](https://docsearch.algolia.com/apply/)
- [VitePress 搜索文档](https://vitepress.dev/reference/default-theme-search)
- [Pagefind 文档](https://pagefind.app/)
- [Meilisearch 文档](https://www.meilisearch.com/)

---

**需要帮助？** 查看其他文档或提交 Issue。

