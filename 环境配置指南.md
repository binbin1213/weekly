# 🔧 Node.js 环境配置指南

## 🤔 Node.js 项目需要虚拟环境吗？

**答案：不需要！** Node.js 项目与 Python 项目不同：

### Python vs Node.js

| 特性 | Python | Node.js |
|-----|--------|---------|
| 依赖安装位置 | 全局或虚拟环境 | 项目本地 `node_modules/` |
| 项目隔离 | 需要 venv/virtualenv | 天然隔离 |
| 版本管理工具 | pyenv | nvm |

### Node.js 的优势

```bash
# 每个项目都有自己的 node_modules
project-a/
  └── node_modules/  # A项目的依赖

project-b/
  └── node_modules/  # B项目的依赖（完全独立）
```

---

## 🎯 推荐方案一：使用 nvm（Node Version Manager）

### 为什么使用 nvm？
- ✅ 管理多个 Node.js 版本
- ✅ 不同项目使用不同版本
- ✅ 快速切换版本
- ✅ 不污染系统环境

### 安装 nvm（macOS/Linux）

```bash
# 1. 安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 2. 重启终端或运行
source ~/.zshrc  # 如果用 zsh
# 或
source ~/.bashrc  # 如果用 bash

# 3. 验证安装
nvm --version
```

### 使用 nvm

```bash
# 安装 Node.js 20（推荐版本）
nvm install 20

# 使用 Node.js 20
nvm use 20

# 设置默认版本
nvm alias default 20

# 查看已安装的版本
nvm ls

# 查看当前版本
node --version
```

### 为项目指定 Node.js 版本

在项目根目录创建 `.nvmrc` 文件：

```bash
# 创建 .nvmrc
echo "20" > .nvmrc
```

然后在项目目录运行：

```bash
nvm use
# 输出: Found '/Users/binbin/Downloads/weekly/.nvmrc' with version <20>
# Now using node v20.x.x
```

---

## 🎯 推荐方案二：使用 pnpm（更高效的包管理器）

### 为什么使用 pnpm？
- ✅ 比 npm 快 2-3 倍
- ✅ 节省磁盘空间（硬链接共享依赖）
- ✅ 严格的依赖管理
- ✅ 完全兼容 npm

### 安装 pnpm

```bash
# 使用 npm 安装
npm install -g pnpm

# 或使用 curl（推荐）
curl -fsSL https://get.pnpm.io/install.sh | sh -

# 验证安装
pnpm --version
```

### 使用 pnpm

```bash
# 安装依赖（替代 npm install）
pnpm install

# 添加依赖
pnpm add vitepress

# 运行脚本
pnpm dev
pnpm build

# 删除依赖
pnpm remove package-name
```

### pnpm 的优势

```bash
# npm 方式：每个项目都完整复制依赖
~/projects/
  project-a/node_modules/  # 500MB
  project-b/node_modules/  # 500MB
  project-c/node_modules/  # 500MB
  总计: 1.5GB

# pnpm 方式：使用硬链接共享
~/.pnpm-store/            # 500MB（所有依赖）
~/projects/
  project-a/node_modules/  # 链接到 store
  project-b/node_modules/  # 链接到 store
  project-c/node_modules/  # 链接到 store
  总计: 500MB + 几MB链接
```

---

## 🎯 推荐方案三：Docker（完全隔离）

### 适合场景
- 需要完全一致的开发环境
- 团队协作
- CI/CD 部署

### 创建 Dockerfile

```dockerfile
# Dockerfile
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

EXPOSE 5173

CMD ["npm", "run", "dev"]
```

### 创建 docker-compose.yml

```yaml
# docker-compose.yml
version: '3.8'

services:
  weekly:
    build: .
    ports:
      - "5173:5173"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
```

### 使用 Docker

```bash
# 构建并启动
docker-compose up

# 后台运行
docker-compose up -d

# 停止
docker-compose down

# 进入容器
docker-compose exec weekly sh
```

---

## 🎯 实际操作：本项目推荐配置

### 方案 A：简单快速（推荐新手）

```bash
# 1. 直接使用系统的 Node.js（确保版本 >= 18）
node --version  # 检查版本

# 2. 安装依赖
cd /Users/binbin/Downloads/weekly
npm install

# 3. 启动开发
npm run dev
```

### 方案 B：使用 nvm + npm（推荐）

```bash
# 1. 安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 2. 安装 Node.js 20
nvm install 20
nvm use 20

# 3. 为项目创建 .nvmrc
cd /Users/binbin/Downloads/weekly
echo "20" > .nvmrc

# 4. 安装依赖
npm install

# 5. 启动开发
npm run dev
```

### 方案 C：使用 nvm + pnpm（最佳性能）

```bash
# 1. 安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 2. 安装 Node.js 20
nvm install 20
nvm use 20

# 3. 安装 pnpm
npm install -g pnpm

# 4. 为项目创建 .nvmrc
cd /Users/binbin/Downloads/weekly
echo "20" > .nvmrc

# 5. 安装依赖
pnpm install

# 6. 启动开发
pnpm dev
```

---

## 📋 环境检查清单

### 检查 Node.js 版本

```bash
node --version
# 应该 >= v18.0.0
```

### 检查 npm 版本

```bash
npm --version
# 应该 >= 9.0.0
```

### 检查是否在正确目录

```bash
pwd
# 应该显示: /Users/binbin/Downloads/weekly
```

### 检查 package.json 是否存在

```bash
ls -la package.json
# 应该显示文件信息
```

---

## 🔧 常用命令对照表

### npm vs pnpm vs yarn

| 操作 | npm | pnpm | yarn |
|-----|-----|------|------|
| 安装依赖 | `npm install` | `pnpm install` | `yarn` |
| 添加依赖 | `npm install pkg` | `pnpm add pkg` | `yarn add pkg` |
| 删除依赖 | `npm uninstall pkg` | `pnpm remove pkg` | `yarn remove pkg` |
| 运行脚本 | `npm run dev` | `pnpm dev` | `yarn dev` |
| 全局安装 | `npm install -g pkg` | `pnpm add -g pkg` | `yarn global add pkg` |

---

## 🚀 快速开始（三选一）

### 🟢 新手推荐：直接使用 npm

```bash
cd /Users/binbin/Downloads/weekly
npm install
npm run dev
```

### 🟡 进阶推荐：nvm + npm

```bash
# 一次性安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.zshrc

# 项目配置
cd /Users/binbin/Downloads/weekly
nvm install 20
nvm use 20
echo "20" > .nvmrc
npm install
npm run dev
```

### 🔵 高级推荐：nvm + pnpm

```bash
# 一次性配置
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.zshrc
nvm install 20
nvm use 20
npm install -g pnpm

# 项目配置
cd /Users/binbin/Downloads/weekly
echo "20" > .nvmrc
pnpm install
pnpm dev
```

---

## 💡 最佳实践建议

### 1. 版本管理
- ✅ 使用 `.nvmrc` 指定 Node.js 版本
- ✅ 在 `package.json` 中指定 engines

```json
{
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=9.0.0"
  }
}
```

### 2. 依赖锁定
- ✅ 提交 `package-lock.json` 到 Git
- ✅ 使用 `npm ci` 代替 `npm install` 在 CI 环境

### 3. 清理缓存
```bash
# npm 缓存清理
npm cache clean --force

# pnpm 缓存清理
pnpm store prune

# 删除 node_modules 重新安装
rm -rf node_modules
npm install
```

### 4. 加速安装（国内用户）
```bash
# 使用淘宝镜像
npm config set registry https://registry.npmmirror.com

# 或临时使用
npm install --registry=https://registry.npmmirror.com
```

---

## ❓ 常见问题

### Q1: 为什么 npm install 很慢？
**A:** 使用国内镜像或切换到 pnpm

```bash
npm config set registry https://registry.npmmirror.com
```

### Q2: node_modules 太大了怎么办？
**A:** 使用 pnpm，可以节省 70% 的空间

### Q3: 不同项目需要不同 Node.js 版本怎么办？
**A:** 使用 nvm，每个项目创建 `.nvmrc` 文件

### Q4: 我应该提交 node_modules 到 Git 吗？
**A:** **不应该！**已经在 `.gitignore` 中忽略了

### Q5: package-lock.json 要提交吗？
**A:** **要！**它锁定了依赖版本，保证环境一致

---

## 🎉 开始开发

选择你喜欢的方式配置好环境后，运行：

```bash
npm run dev
# 或
pnpm dev
```

然后访问 `http://localhost:5173` 即可！

---

**记住：Node.js 项目天然就是隔离的，不需要像 Python 那样的虚拟环境！** ✨

